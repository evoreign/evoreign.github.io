<!DOCTYPE html>
<html lang="id">
   <head>
      <meta charset="UTF-8">
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      <title>Keranjang Belanja - Beliin.id</title>
      <link rel="stylesheet" href="./component/css/main.css">
      <script src="https://unpkg.com/lucide@latest"></script>
      <style>
         .icon { display: inline-block; width: 1em; height: 1em; vertical-align: -0.125em; }
         .product-image-placeholder img { width: 100%; height: 100%; object-fit: contain; border-radius: var(--radius); }
      </style>
      <link rel="icon" href="./assets/logo.PNG" type="image/png">
   </head>
   <body class="page-body">
      <header class="site-header">
         <div class="header-container">
            <div class="logo-container">
               <a href="index.html" class="logo-link">
               <img src="./assets/logo.jpeg" alt="Logo Beliin.id" class="logo" style="width: 15%; height: 15%; object-fit: cover; border-radius: var(--radius);">
               </a>
            </div>
            <div class="search-bar-container new-search-bar desktop-search">
               <form action="#" class="search-form">
                  <i data-lucide="search" class="icon search-icon-inside"></i>
                  <input type="search" class="form-input search-input" placeholder="Cari produk, kategori, atau toko...">
               </form>
            </div>
            <nav class="header-actions">
               <button type="button" class="btn btn-ghost btn-icon mobile-search-trigger" aria-label="Buka Pencarian">
               <i data-lucide="search" class="icon"></i>
               </button>
               <a href="keranjang.html" class="btn btn-ghost btn-icon" aria-label="Keranjang Belanja">
               <i data-lucide="shopping-cart" class="icon"></i>
               </a>
               <a href="wishlist.html" class="btn btn-ghost btn-icon" aria-label="Wishlist">
               <i data-lucide="heart" class="icon"></i>
               </a>
               <a href="chat.html" class="btn btn-ghost btn-icon" aria-label="Chat">
               <i data-lucide="message-circle" class="icon"></i>
               </a>
               <a href="profile.html" class="btn btn-ghost btn-icon" aria-label="Profil Pengguna">
               <i data-lucide="user" class="icon"></i>
               </a>
            </nav>
         </div>
      </header>
      <div class="search-overlay" id="searchOverlay">
         <div class="search-overlay-header">
            <div class="search-bar-container new-search-bar">
               <form action="#" class="search-form">
                  <i data-lucide="search" class="icon search-icon-inside"></i>
                  <input type="search" class="form-input search-input" placeholder="Cari di Beliin.id..." id="mobileSearchInput">
               </form>
            </div>
            <button type="button" class="btn btn-link search-overlay-close" id="searchOverlayClose">Batal</button>
         </div>
         <div class="search-overlay-content">
         </div>
      </div>
      <main class="shopping-cart-page container">
         <h1 class="page-title">Keranjang</h1>
         <div class="cart-content">
            <div class="select-all-bar">
               <label class="form-checkbox-container">
                  <input type="checkbox" class="form-checkbox" id="select-all-items">
                  <span class="form-checkbox-indicator">
                     <svg viewBox="0 0 16 16" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
                        <path d="M12.207 4.793a1 1 0 010 1.414l-5 5a1 1 0 01-1.414 0l-2-2a1 1 0 011.414-1.414L6.5 9.086l4.293-4.293a1 1 0 011.414 0z"></path>
                     </svg>
                  </span>
                  <span class="form-checkbox-label" id="selectAllLabel">Pilih Semua (0)</span>
               </label>
               <button type="button" class="btn btn-link btn-sm" id="deleteSelectedButton" style="display:none; color:hsl(var(--destructive));">Hapus Terpilih</button>
            </div>
            <div class="cart-items-grid">
               <div class="cart-item card" data-price="75000" data-id="product1">
                  <div class="item-selection">
                     <label class="form-checkbox-container">
                        <input type="checkbox" class="form-checkbox cart-item-checkbox" name="cart-item-select-1">
                        <span class="form-checkbox-indicator">
                           <svg viewBox="0 0 16 16" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
                              <path d="M12.207 4.793a1 1 0 010 1.414l-5 5a1 1 0 01-1.414 0l-2-2a1 1 0 011.414-1.414L6.5 9.086l4.293-4.293a1 1 0 011.414 0z"></path>
                           </svg>
                        </span>
                     </label>
                  </div>
                  <a href="detailProduct.html?id=product1" class="product-image-placeholder">
                  <img src="./assets/cart/1.jpg" alt="Nama Produk Keren">
                  </a>
                  <div class="product-details">
                     <a href="detailProduct.html?id=product1" style="text-decoration:none; color:inherit;">
                        <h3 class="product-name">Nama Produk Keren</h3>
                     </a>
                     <p class="product-price">Rp 75.000</p>
                  </div>
                  <div class="quantity-adjuster">
                     <button type="button" class="btn btn-outline btn-icon btn-sm quantity-button" data-action="decrease" aria-label="Kurangi jumlah">
                     <i data-lucide="minus" class="icon"></i>
                     </button>
                     <input type="number" class="form-input quantity-display" value="1" min="1" max="99" aria-label="Jumlah produk">
                     <button type="button" class="btn btn-outline btn-icon btn-sm quantity-button" data-action="increase" aria-label="Tambah jumlah">
                     <i data-lucide="plus" class="icon"></i>
                     </button>
                  </div>
               </div>
               <div class="cart-item card" data-price="120000" data-id="product2">
                  <div class="item-selection">
                     <label class="form-checkbox-container">
                        <input type="checkbox" class="form-checkbox cart-item-checkbox" name="cart-item-select-2">
                        <span class="form-checkbox-indicator">
                           <svg viewBox="0 0 16 16" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
                              <path d="M12.207 4.793a1 1 0 010 1.414l-5 5a1 1 0 01-1.414 0l-2-2a1 1 0 011.414-1.414L6.5 9.086l4.293-4.293a1 1 0 011.414 0z"></path>
                           </svg>
                        </span>
                     </label>
                  </div>
                  <a href="detailProduct.html?id=product2" class="product-image-placeholder">
                  <img src="./assets/cart/2.jpg" alt="Produk Lain Contoh">
                  </a>
                  <div class="product-details">
                     <a href="detailProduct.html?id=product2" style="text-decoration:none; color:inherit;">
                        <h3 class="product-name">Produk Lain Contoh</h3>
                     </a>
                     <p class="product-price">Rp 120.000</p>
                  </div>
                  <div class="quantity-adjuster">
                     <button type="button" class="btn btn-outline btn-icon btn-sm quantity-button" data-action="decrease" aria-label="Kurangi jumlah">
                     <i data-lucide="minus" class="icon"></i>
                     </button>
                     <input type="number" class="form-input quantity-display" value="1" min="1" max="99" aria-label="Jumlah produk">
                     <button type="button" class="btn btn-outline btn-icon btn-sm quantity-button" data-action="increase" aria-label="Tambah jumlah">
                     <i data-lucide="plus" class="icon"></i>
                     </button>
                  </div>
               </div>
            </div>
            <hr class="cart-separator">
            <div class="cart-summary">
               <div class="total-payment-info">
                  <span class="total-label">Total Pembayaran:</span>
                  <span class="total-amount" id="totalAmount">Rp 0</span>
               </div>
               <button type="button" class="btn btn-primary checkout-button" id="checkoutButton">Beli (0)</button>
            </div>
         </div>
      </main>
      <script>
         document.addEventListener('DOMContentLoaded', function () {
             // ADD THIS JAVASCRIPT TO YOUR <script> TAGS
         
         // --- Search Overlay Logic ---
         const searchOverlay = document.getElementById('searchOverlay');
         const searchTrigger = document.querySelector('.mobile-search-trigger');
         const searchClose = document.getElementById('searchOverlayClose');
         const mobileSearchInput = document.getElementById('mobileSearchInput');
         
         if (searchTrigger) {
             searchTrigger.addEventListener('click', () => {
                 if (searchOverlay) {
                     searchOverlay.classList.add('is-active');
                     // Automatically focus the input field when the overlay opens
                     if(mobileSearchInput) mobileSearchInput.focus();
                 }
             });
         }
         
         if (searchClose) {
             searchClose.addEventListener('click', () => {
                 if (searchOverlay) {
                     searchOverlay.classList.remove('is-active');
                 }
             });
         }
             lucide.createIcons();
         
             const selectAllCheckbox = document.getElementById('select-all-items');
             const selectAllLabel = document.getElementById('selectAllLabel');
             // We will query cartItemCheckboxes and cartItems dynamically inside functions
             // to ensure they are always up-to-date after DOM manipulations.
             const totalAmountElement = document.getElementById('totalAmount');
             const checkoutButton = document.getElementById('checkoutButton');
             const deleteSelectedButton = document.getElementById('deleteSelectedButton');
             const cartItemsGrid = document.querySelector('.cart-items-grid');
         
         
             function formatCurrency(amount) {
                 return 'Rp ' + amount.toLocaleString('id-ID');
             }
         
             function updateTotal() {
                 let total = 0;
                 let selectedCount = 0;
                 const currentCartItems = document.querySelectorAll('.cart-item'); // Query current items
                 const currentCartItemCheckboxes = document.querySelectorAll('.cart-item-checkbox'); // Query current checkboxes
         
                 currentCartItems.forEach(item => {
                     const checkbox = item.querySelector('.cart-item-checkbox');
                     if (checkbox && checkbox.checked) { // Ensure checkbox exists
                         const price = parseFloat(item.dataset.price);
                         const quantity = parseInt(item.querySelector('.quantity-display').value);
                         if (!isNaN(price) && !isNaN(quantity)) {
                             total += price * quantity;
                             selectedCount++;
                         }
                     }
                 });
         
                 if (totalAmountElement) totalAmountElement.textContent = formatCurrency(total);
                 if (checkoutButton) checkoutButton.textContent = `Beli (${selectedCount})`;
                 if (selectAllLabel) selectAllLabel.textContent = `Pilih Semua (${selectedCount})`;
         
                 if (selectAllCheckbox) {
                     const allSelected = selectedCount === currentCartItemCheckboxes.length && currentCartItemCheckboxes.length > 0;
                     const someSelected = selectedCount > 0 && selectedCount < currentCartItemCheckboxes.length;
                     selectAllCheckbox.checked = allSelected;
                     selectAllCheckbox.indeterminate = someSelected;
                 }
         
                 if (deleteSelectedButton) {
                     deleteSelectedButton.style.display = selectedCount > 0 ? 'inline-flex' : 'none';
                 }
             }
         
             function setupCartItemEventListeners(itemElement) {
                 const quantityDisplay = itemElement.querySelector('.quantity-display');
                 const maxQuantity = parseInt(quantityDisplay.getAttribute('max') || 99);
                 const itemCheckbox = itemElement.querySelector('.cart-item-checkbox');
         
                 itemElement.querySelectorAll('.quantity-button').forEach(button => {
                     button.addEventListener('click', function () {
                         let quantity = parseInt(quantityDisplay.value);
                         const action = this.dataset.action;
                         if (action === 'increase' && quantity < maxQuantity) {
                             quantity++;
                         } else if (action === 'decrease' && quantity > 1) {
                             quantity--;
                         }
                         quantityDisplay.value = quantity;
                         updateTotal();
                     });
                 });
         
                 if (quantityDisplay) {
                     quantityDisplay.addEventListener('change', function() {
                         let quantity = parseInt(this.value);
                         if (isNaN(quantity) || quantity < 1) {
                             this.value = 1;
                         } else if (quantity > maxQuantity) {
                             this.value = maxQuantity;
                             alert(`Maksimal pembelian ${maxQuantity} item.`);
                         }
                         updateTotal();
                     });
                 }
                 if (itemCheckbox) {
                     itemCheckbox.addEventListener('change', updateTotal);
                 }
             }
         
             // Initial setup for existing cart items
             document.querySelectorAll('.cart-item').forEach(item => {
                 setupCartItemEventListeners(item);
             });
         
         
             if (selectAllCheckbox) {
                 selectAllCheckbox.addEventListener('change', function () {
                     document.querySelectorAll('.cart-item-checkbox').forEach(checkbox => {
                         checkbox.checked = this.checked;
                     });
                     updateTotal();
                 });
             }
         
         
             if (checkoutButton) {
                 checkoutButton.addEventListener('click', function () {
                     const selectedItemsCount = document.querySelectorAll('.cart-item-checkbox:checked').length;
                     if (selectedItemsCount === 0) {
                         alert('Keranjang Anda kosong atau tidak ada item yang dipilih. Silakan pilih item untuk dibeli.');
                         return;
                     }
                     window.location.href = 'checkout.html';
                 });
             }
         
             if (deleteSelectedButton) {
                 deleteSelectedButton.addEventListener('click', function() {
                     const selectedItemCheckboxes = document.querySelectorAll('.cart-item-checkbox:checked');
                     if (selectedItemCheckboxes.length === 0) {
                         alert('Tidak ada item yang dipilih untuk dihapus.');
                         return;
                     }
                     if (confirm(`Anda yakin ingin menghapus ${selectedItemCheckboxes.length} item terpilih dari keranjang?`)) {
                         selectedItemCheckboxes.forEach(checkbox => {
                             checkbox.closest('.cart-item').remove();
                         });
                         updateTotal(); // This will re-evaluate everything based on the modified DOM
                     }
                 });
             }
         
             // Initial calculation on page load
             updateTotal();
         });
      </script>
   </body>
</html>